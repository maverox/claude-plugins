# Comment Formatting Reference

Guidelines for formatting GitHub PR review comments with professional structure and clear communication.

## Comment Structure Template

```markdown
## {severity_emoji} {SEVERITY}: {category}

**Issue**: {one-line-summary}

### Current Implementation
```{language}
{current_code}
```
{status_emoji} {impact_summary}

### Suggested Fix
```{language}
{suggested_fix}
```
{success_emoji} {benefit_summary}

### Why This Matters
{detailed_explanation}

### Impact Assessment
- **Severity**: {severity} ({priority})
- **Failure Mode**: {what_breaks_if_not_fixed}
- **Effort to Fix**: {Low|Medium|High}

---
*Auto-generated by code-quality-review | Line {line_number} | Commit {short_sha}*
```

## Severity Indicators

| Severity | Emoji | Label | Usage |
|----------|-------|-------|-------|
| Critical | `` | `CRITICAL` | Security vulnerabilities, crashes, data loss |
| Warning | `` | `WARNING` | Bugs, performance issues, bad practices |
| Suggestion | `` | `SUGGESTION` | Style, documentation, minor improvements |

## Status Emojis

| Context | Emoji | Meaning |
|---------|-------|---------|
| Problem | `` | Current code issue |
| Warning | `` | Potential issue |
| Solution | `` | Suggested fix |
| Info | `` | Additional context |

## Categories

Common issue categories for the `{category}` field:

- **Security** - Vulnerabilities, injection, secrets
- **Error Handling** - Exceptions, error propagation
- **Performance** - Efficiency, memory, queries
- **Type Safety** - Type errors, null safety
- **Code Quality** - Readability, maintainability
- **Documentation** - Comments, docs, naming
- **Testing** - Test coverage, assertions
- **Best Practices** - Design patterns, conventions

## Code Block Formatting

### Always Specify Language

```typescript
// TypeScript
const result = await fetchData();
```

```python
# Python
result = await fetch_data()
```

```rust
// Rust
let result = fetch_data().await?;
```

### Inline Annotations

Add comments within code blocks to highlight issues:

```typescript
// AVOID: Empty catch block
try {
  await saveData();
} catch (e) { }  // <- Error silently swallowed

// PREFER: Proper error handling
try {
  await saveData();
} catch (e) {
  logger.error('Failed to save', { error: e });
  throw e;  // Re-throw or handle appropriately
}
```

## Issue Description Patterns

### Be Specific

**Good**: "SQL query concatenates user input without parameterization"

**Bad**: "Security issue"

### Include Impact

**Good**: "Empty catch block will hide database connection failures, making debugging impossible"

**Bad**: "Don't use empty catch"

### Provide Context

**Good**: "The `user_id` from request params is passed directly to SQL without validation"

**Bad**: "Input validation missing"

## Suggested Fix Patterns

### Exact Replacement

When fix is straightforward:

```typescript
// Replace this:
const query = `SELECT * FROM users WHERE id = ${userId}`;

// With this:
const query = 'SELECT * FROM users WHERE id = ?';
const result = await db.query(query, [userId]);
```

### Multiple Options

When there are valid alternatives:

```typescript
// Option 1: Use parameterized query
const result = await db.query('SELECT * FROM users WHERE id = ?', [userId]);

// Option 2: Use ORM
const user = await User.findById(userId);
```

### Step-by-Step

For complex fixes:

```markdown
### Suggested Fix

1. Create a validation function:
   ```typescript
   function validateUserId(id: string): number {
     const parsed = parseInt(id, 10);
     if (isNaN(parsed) || parsed <= 0) {
       throw new ValidationError('Invalid user ID');
     }
     return parsed;
   }
   ```

2. Use it in the handler:
   ```typescript
   const userId = validateUserId(req.params.id);
   const user = await User.findById(userId);
   ```
```

## Complete Examples

### Critical Issue

```markdown
## CRITICAL: Security

**Issue**: SQL injection vulnerability - user input directly interpolated into query

### Current Implementation
```typescript
const query = `SELECT * FROM users WHERE email = '${req.body.email}'`;
const user = await db.query(query);
```
 Attacker can execute arbitrary SQL commands

### Suggested Fix
```typescript
const query = 'SELECT * FROM users WHERE email = ?';
const user = await db.query(query, [req.body.email]);
```
 Parameterized query prevents injection

### Why This Matters
SQL injection is a critical vulnerability that allows attackers to:
- Read sensitive data from the database
- Modify or delete data
- Bypass authentication
- Execute administrative operations

This endpoint is exposed without authentication, making it a high-value target.

### Impact Assessment
- **Severity**: Critical (P0 - Blocks Merge)
- **Failure Mode**: Complete database compromise
- **Effort to Fix**: Low (change to parameterized query)
- **Testing Required**: Manual security testing, automated SQL injection scan

---
*Auto-generated by code-quality-review | Line 45 | Commit abc123d*
```

### Warning Issue

```markdown
## WARNING: Error Handling

**Issue**: Empty catch block silently swallows database errors

### Current Implementation
```typescript
try {
  await saveUserData(user);
} catch (e) {
  // TODO: handle error
}
```
 Database failures will go unnoticed

### Suggested Fix
```typescript
try {
  await saveUserData(user);
} catch (e) {
  logger.error('Failed to save user data', { userId: user.id, error: e });
  throw new DatabaseError('User save failed', { cause: e });
}
```
 Errors are logged and properly propagated

### Why This Matters
Silent failures make debugging extremely difficult. If the database connection fails or the save operation throws, the application will continue as if everything succeeded, potentially leading to data inconsistency.

### Impact Assessment
- **Severity**: Warning (P1 - Should Fix)
- **Code Quality Impact**: Debugging difficulty, potential data loss
- **Effort to Fix**: Low (add error logging and re-throw)

---
*Auto-generated by code-quality-review | Line 78 | Commit def456g*
```

### Suggestion

```markdown
## SUGGESTION: Documentation

**Issue**: Public API function missing JSDoc documentation

### Current Implementation
```typescript
export function calculateDiscount(price: number, percentage: number): number {
  return price * (1 - percentage / 100);
}
```
 Function purpose and parameters are unclear

### Suggested Fix
```typescript
/**
 * Calculates the discounted price based on a percentage discount.
 *
 * @param price - Original price in cents
 * @param percentage - Discount percentage (0-100)
 * @returns Discounted price in cents
 * @throws {Error} If percentage is negative or greater than 100
 *
 * @example
 * calculateDiscount(1000, 20) // Returns 800 (20% off $10.00)
 */
export function calculateDiscount(price: number, percentage: number): number {
  if (percentage < 0 || percentage > 100) {
    throw new Error('Invalid discount percentage');
  }
  return price * (1 - percentage / 100);
}
```
 Clear documentation improves maintainability

### Why This Matters
This function is part of the public API and is used across multiple services. Clear documentation helps other developers understand the expected input format (cents vs dollars) and edge cases.

### Impact Assessment
- **Severity**: Suggestion (P2 - Nice to Have)
- **Benefit**: Improved API discoverability and reduced confusion
- **Effort to Fix**: Low (add JSDoc comments)

---
*Auto-generated by code-quality-review | Line 156 | Commit hij789k*
```

## Tone and Style Guidelines

### Professional

- Avoid blame or criticism of the author
- Focus on the code, not the person
- Use "we" instead of "you" when possible

### Constructive

- Always provide a suggested fix
- Explain why the change matters
- Give context for the recommendation

### Concise

- Keep the issue summary to one line
- Use bullet points for lists
- Avoid redundant explanations

### Actionable

- Be specific about what to change
- Include code examples
- Reference documentation when helpful

## Formatting Checklist

Before publishing a comment, verify:

- [ ] Severity emoji and label match
- [ ] Issue summary is clear and specific
- [ ] Code blocks specify the correct language
- [ ] Current code matches what's in the file
- [ ] Suggested fix is complete and correct
- [ ] Why This Matters explains the impact
- [ ] Impact Assessment is appropriate for severity
- [ ] Footer includes line number and commit SHA
